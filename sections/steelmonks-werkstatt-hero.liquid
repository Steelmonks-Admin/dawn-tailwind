{% comment %}
  Werkstatt From-To (Final + Black Pill + 3 Trust Features)
  - Keeps exact From-To layout as approved
  - Adds Black pill + 3 features row above (same style language as your hero)
{% endcomment %}

{% schema %}
{
  "name": "Werkstatt From-To",
  "tag": "section",
  "settings": [
    {
      "type": "range",
      "id": "top_spacing",
      "label": "Abstand oben",
      "default": 34,
      "min": 0,
      "max": 180,
      "step": 2
    },
    {
      "type": "range",
      "id": "bottom_spacing",
      "label": "Abstand unten",
      "default": 40,
      "min": 0,
      "max": 200,
      "step": 2
    },

    {
      "type": "text",
      "id": "badge_text",
      "label": "Black Pill Text",
      "default": "Die Steelmonks Werkstatt"
    },

    {
      "type": "text",
      "id": "trust_1_icon",
      "label": "Trust 1 Icon",
      "default": "üá©üá™"
    },
    {
      "type": "text",
      "id": "trust_1_text",
      "label": "Trust 1 Text",
      "default": "Schneller Versand."
    },
    {
      "type": "text",
      "id": "trust_2_icon",
      "label": "Trust 2 Icon",
      "default": "üèÖ"
    },
    {
      "type": "text",
      "id": "trust_2_text",
      "label": "Trust 2 Text",
      "default": "√úber 100.000+ Bestellungen."
    },
    {
      "type": "text",
      "id": "trust_3_icon",
      "label": "Trust 3 Icon",
      "default": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê"
    },
    {
      "type": "text",
      "id": "trust_3_text",
      "label": "Trust 3 Text",
      "default": "10.000+ Bewertungen."
    },

    {
      "type": "text",
      "id": "heading",
      "label": "Heading (left)",
      "default": "Von einem Foto"
    },
    {
      "type": "text",
      "id": "heading_2",
      "label": "Heading (right)",
      "default": "zu deinem Metallschild"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "in 2 Minuten"
    },

    {
      "type": "image_picker",
      "id": "from_image",
      "label": "From image (photo reference)"
    },
    {
      "type": "textarea",
      "id": "from_label",
      "label": "Label unter linkem Bild",
      "default": "Lade ein Foto oder eine Skizze hoch"
    },
    {
      "type": "image_picker",
      "id": "to_image",
      "label": "To image (metal sign)"
    },
    {
      "type": "textarea",
      "id": "to_label",
      "label": "Label unter rechtem Bild",
      "default": "Wir verwandeln es in ein sauberes, schnittf√§higes Schild"
    },

    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay animation",
      "default": true
    },
    {
      "type": "range",
      "id": "duration_seconds",
      "min": 6,
      "max": 20,
      "step": 1,
      "unit": "s",
      "label": "Animation loop duration (visual)",
      "default": 10
    }
  ],
  "presets": [
    { "name": "Werkstatt From-To" }
  ]
}
{% endschema %}

<section
  id="smwh-fromto-{{ section.id }}"
  class="smwft"
  aria-label="Von Foto zu Schild"
  style="padding-top: {{ section.settings.top_spacing | default: 34 }}px; padding-bottom: {{ section.settings.bottom_spacing | default: 40 }}px;"
>
  <style>
    #smwh-fromto-{{ section.id }}{
      --ink: rgba(9,10,12,0.92);
      --muted: rgba(9,10,12,0.68);
      --stroke: rgba(9,10,12,0.10);
      --shadow2: 0 16px 34px rgba(15,23,42,0.10);

      --radius: 32px;
      --img-radius: 30px;

      /* Steelmonks accents */
      --a1: #ff9800;
      --a2: #0044CC;
      --a3: #00235e;

      --loop: {{ section.settings.duration_seconds | default: 10 }}s;

      --gap: 38px;
      --midw: 248px;
    }

    #smwh-fromto-{{ section.id }}{
      background: transparent;
      color: var(--ink);
    }

    #smwh-fromto-{{ section.id }} .smwft__wrap{
      max-width: 1240px;
      margin: 0 auto;
      padding: 0 16px;
    }

    /* ===== Top (Black pill + Trust row) ===== */
    #smwh-fromto-{{ section.id }} .smwft__top{
      display: grid;
      justify-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    #smwh-fromto-{{ section.id }} .smwft__pill-black{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 20px;
      border-radius: 999px;
      background: #090A0C;
      color: rgba(255,255,255,0.96);
      font-size: 1.05rem;
      font-weight: 900;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      box-shadow: 0 14px 34px rgba(0,0,0,0.45);
    }

    #smwh-fromto-{{ section.id }} .smwft__pill-black::before{
      content: "";
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--a1);
      box-shadow: 0 0 0 4px rgba(255,152,0,0.35);
    }

    #smwh-fromto-{{ section.id }} .smwft__trust{
      width: 100%;
      max-width: 980px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    #smwh-fromto-{{ section.id }} .smwft__trust-item{
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    #smwh-fromto-{{ section.id }} .smwft__trust-ico{
      font-size: 1.2rem;
    }

    #smwh-fromto-{{ section.id }} .smwft__trust-txt{
      font-size: 1.05rem;
      color: rgba(9,10,12,0.68);
      font-weight: 700;
    }

    @media (min-width: 768px){
      #smwh-fromto-{{ section.id }} .smwft__trust{
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
      }
      #smwh-fromto-{{ section.id }} .smwft__pill-black{
        padding: 12px 28px;
        font-size: 1.18rem;
      }
    }

    /* ===== Headline ===== */
    #smwh-fromto-{{ section.id }} .smwft__head{
      text-align: center;
      margin-bottom: 18px;
    }

    #smwh-fromto-{{ section.id }} .smwft__title{
      margin: 0;
      font-weight: 900;
      letter-spacing: -0.02em;
      color: var(--ink);
      font-size: clamp(22px, 2.9vw, 38px);
      line-height: 1.12;
    }

    #smwh-fromto-{{ section.id }} .smwft__sub{
      margin: 10px 0 0;
      color: var(--muted);
      font-size: 13px;
      letter-spacing: 0.2px;
    }

    /* ===== Layout: image | timer | image ===== */
    #smwh-fromto-{{ section.id }} .smwft__grid{
      display: grid;
      grid-template-columns: 1fr var(--midw) 1fr;
      gap: var(--gap);
      align-items: center;
    }

    /* Image cards */
    #smwh-fromto-{{ section.id }} .smwft__img-card{
      border-radius: var(--img-radius);
      aspect-ratio: 1 / 1;
      overflow: hidden;
      background: rgba(9,10,12,0.05);
      border: 1px solid rgba(9,10,12,0.08);
      box-shadow: var(--shadow2);
      position: relative;
      transform: translateZ(0);
      will-change: transform;
    }

    #smwh-fromto-{{ section.id }} .smwft__img{
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scale(1);
      transition: transform 560ms cubic-bezier(0.2,0.8,0.2,1), filter 320ms ease;
      will-change: transform, filter;
    }

    #smwh-fromto-{{ section.id }} .smwft__img-card:hover .smwft__img{
      transform: scale(1.04);
      filter: saturate(0.96);
    }

    /* Single labels */
    #smwh-fromto-{{ section.id }} .smwft__label{
      margin-top: 12px;
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(9,10,12,0.10);
      background: rgba(255,255,255,0.62);
      box-shadow: var(--shadow2);
      padding: 11px 14px;
      text-align: center;
      color: rgba(9,10,12,0.82);
      font-size: 13px;
      font-weight: 800;
      letter-spacing: 0.1px;
      line-height: 1.25;
      min-height: 46px;
      white-space: pre-wrap;
    }

    /* Timer block */
    #smwh-fromto-{{ section.id }} .smwft__mid{
      position: relative;
      display: grid;
      gap: 10px;
      justify-items: center;
      padding: 14px 12px 12px;
      border-radius: 24px;
      background: rgba(9,10,12,0.28);
      border: 1px solid rgba(255,255,255,0.18);
      box-shadow: 0 22px 60px rgba(0,0,0,0.22);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      transform: translateZ(0);
      isolation: isolate;
      overflow: hidden;
    }

    #smwh-fromto-{{ section.id }} .smwft__mid:before{
      content: "";
      position: absolute;
      inset: -2px;
      border-radius: 26px;
      background:
        radial-gradient(90% 70% at 20% 10%, rgba(255,152,0,0.40), rgba(255,255,255,0) 55%),
        radial-gradient(90% 70% at 80% 10%, rgba(0,68,204,0.35), rgba(255,255,255,0) 55%);
      filter: blur(2px);
      opacity: 0.85;
      z-index: 0;
      pointer-events: none;
    }

    #smwh-fromto-{{ section.id }} .smwft__mid:after{
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.14);
      background: linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.02));
      z-index: 0;
      pointer-events: none;
    }

    #smwh-fromto-{{ section.id }} .smwft__pill{
      position: relative;
      z-index: 1;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 9px 11px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.10);
      color: rgba(255,255,255,0.92);
      font-size: 12px;
      line-height: 1;
      user-select: none;
    }

    #smwh-fromto-{{ section.id }} .smwft__pill-dot{
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255,255,255,0.84);
      box-shadow: 0 0 0 6px rgba(255,255,255,0.10);
    }

    #smwh-fromto-{{ section.id }} .smwft__ring{
      position: relative;
      z-index: 1;
      width: 86px;
      height: 86px;
      border-radius: 999px;
      display: grid;
      place-items: center;
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.16);
      box-shadow: 0 1px 0 rgba(255,255,255,0.22) inset;
      overflow: hidden;
    }

    #smwh-fromto-{{ section.id }} .smwft__ring:before{
      content: "";
      position: absolute;
      inset: 9px;
      border-radius: 999px;
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.12);
    }

    #smwh-fromto-{{ section.id }} .smwft__ring svg{
      position: absolute;
      inset: 0;
      transform: rotate(-90deg);
    }

    #smwh-fromto-{{ section.id }} .smwft__ring circle{
      fill: none;
      stroke-width: 8;
      stroke-linecap: round;
    }

    #smwh-fromto-{{ section.id }} .smwft__track{
      stroke: rgba(255,255,255,0.16);
    }

    #smwh-fromto-{{ section.id }} .smwft__prog{
      stroke: url(#smwft-grad-{{ section.id }});
      stroke-dasharray: 251.2;
      stroke-dashoffset: 251.2;
      animation: smwftRing var(--loop) linear infinite;
    }

    #smwh-fromto-{{ section.id }}[data-autoplay="0"] .smwft__prog{
      animation: none !important;
    }

    #smwh-fromto-{{ section.id }} .smwft__time{
      position: relative;
      z-index: 1;
      color: rgba(255,255,255,0.95);
      font-weight: 900;
      letter-spacing: -0.01em;
      font-size: 14px;
    }

    #smwh-fromto-{{ section.id }} .smwft__scan{
      position: relative;
      z-index: 1;
      width: 100%;
      height: 9px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.10);
      overflow: hidden;
    }

    #smwh-fromto-{{ section.id }} .smwft__scan:before{
      content: "";
      position: absolute;
      top: -40%;
      left: -30%;
      width: 40%;
      height: 180%;
      background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.75) 45%, rgba(255,255,255,0) 100%);
      transform: skewX(-18deg);
      animation: smwftScan var(--loop) cubic-bezier(0.2,0.8,0.2,1) infinite;
      opacity: 0.95;
    }

    #smwh-fromto-{{ section.id }}[data-autoplay="0"] .smwft__scan:before{
      animation: none !important;
    }

    #smwh-fromto-{{ section.id }} .smwft__status{
      position: relative;
      z-index: 1;
      font-size: 12px;
      color: rgba(255,255,255,0.84);
      letter-spacing: 0.2px;
      text-align: center;
      min-height: 18px;
    }

    #smwh-fromto-{{ section.id }} .smwft__status b{
      color: rgba(255,255,255,0.96);
      font-weight: 900;
    }

    @keyframes smwftFloat{
      0%{ transform: translateY(0); }
      50%{ transform: translateY(-6px); }
      100%{ transform: translateY(0); }
    }

    #smwh-fromto-{{ section.id }}[data-autoplay="1"] .smwft__mid{
      animation: smwftFloat 7.5s ease-in-out infinite;
    }

    @keyframes smwftRing{
      0%{ stroke-dashoffset: 251.2; }
      100%{ stroke-dashoffset: 0; }
    }

    @keyframes smwftScan{
      0%{ left: -45%; opacity: 0.0; }
      8%{ opacity: 0.95; }
      40%{ left: 110%; opacity: 0.95; }
      55%{ opacity: 0.0; }
      100%{ left: 110%; opacity: 0.0; }
    }

    /* Mobile */
    @media (max-width: 900px){
      #smwh-fromto-{{ section.id }}{
        --gap: 16px;
        --midw: 1fr;
      }

      #smwh-fromto-{{ section.id }} .smwft__grid{
        grid-template-columns: 1fr;
        gap: 14px;
      }

      #smwh-fromto-{{ section.id }} .smwft__mid{
        max-width: 400px;
        margin: 0 auto;
        animation: none;
      }
    }

    @media (prefers-reduced-motion: reduce){
      #smwh-fromto-{{ section.id }} .smwft__prog,
      #smwh-fromto-{{ section.id }} .smwft__scan:before,
      #smwh-fromto-{{ section.id }} .smwft__mid,
      #smwh-fromto-{{ section.id }} .smwft__img{
        animation: none !important;
        transition: none !important;
      }
    }
  </style>

  <div class="smwft__wrap">
    <div class="smwft__top">
      {% if section.settings.badge_text != blank %}
        <div class="smwft__pill-black">{{ section.settings.badge_text }}</div>
      {% endif %}

      <div class="smwft__trust" aria-label="Trust Row">
        <div class="smwft__trust-item">
          <div class="smwft__trust-ico">{{ section.settings.trust_1_icon }}</div>
          <div class="smwft__trust-txt">{{ section.settings.trust_1_text }}</div>
        </div>
        <div class="smwft__trust-item">
          <div class="smwft__trust-ico">{{ section.settings.trust_2_icon }}</div>
          <div class="smwft__trust-txt">{{ section.settings.trust_2_text }}</div>
        </div>
        <div class="smwft__trust-item">
          <div class="smwft__trust-ico">{{ section.settings.trust_3_icon }}</div>
          <div class="smwft__trust-txt">{{ section.settings.trust_3_text }}</div>
        </div>
      </div>
    </div>

    <div class="smwft__head">
      <h2 class="smwft__title">
        <span>{{ section.settings.heading }}</span>
        <span> {{ section.settings.heading_2 }}</span>
      </h2>
      <p class="smwft__sub">{{ section.settings.subheading }}</p>
    </div>

    <div class="smwft__grid">
      <div>
        <div class="smwft__img-card">
          {% if section.settings.from_image != blank %}
            <img class="smwft__img" src="{{ section.settings.from_image | image_url: width: 1800 }}" alt="{{ section.settings.from_image.alt | escape }}" loading="lazy" width="1800" height="1800">
          {% else %}
            <img class="smwft__img" src="https://placehold.co/1800x1800" alt="Placeholder" loading="lazy" width="1800" height="1800">
          {% endif %}
        </div>
        <div class="smwft__label">{{ section.settings.from_label | escape }}</div>
      </div>

      <div class="smwft__mid" aria-hidden="false">
        <div class="smwft__pill" aria-label="in 2 Minuten">
          <span class="smwft__pill-dot" aria-hidden="true"></span>
          <span><b>in 2 Minuten</b></span>
        </div>

        <div class="smwft__ring" aria-label="Processing indicator">
          <svg viewBox="0 0 100 100" aria-hidden="true">
            <defs>
              <linearGradient id="smwft-grad-{{ section.id }}" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="var(--a1)"/>
                <stop offset="55%" stop-color="var(--a2)"/>
                <stop offset="100%" stop-color="var(--a3)"/>
              </linearGradient>
            </defs>
            <circle class="smwft__track" cx="50" cy="50" r="40"></circle>
            <circle class="smwft__prog" cx="50" cy="50" r="40"></circle>
          </svg>
          <div class="smwft__time" id="smwft-time-{{ section.id }}">02:00</div>
        </div>

        <div class="smwft__scan" aria-hidden="true"></div>
        <div class="smwft__status" id="smwft-status-{{ section.id }}">Wir bauen deinen <b>Entwurf</b> ‚Ä¶</div>
      </div>

      <div>
        <div class="smwft__img-card">
          {% if section.settings.to_image != blank %}
            <img class="smwft__img" src="{{ section.settings.to_image | image_url: width: 1800 }}" alt="{{ section.settings.to_image.alt | escape }}" loading="lazy" width="1800" height="1800">
          {% else %}
            <img class="smwft__img" src="https://placehold.co/1800x1800" alt="Placeholder" loading="lazy" width="1800" height="1800">
          {% endif %}
        </div>
        <div class="smwft__label">{{ section.settings.to_label | escape }}</div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      var SECTION_ID = "{{ section.id }}";
      var rootId = "smwh-fromto-" + SECTION_ID;

      function init(){
        var root = document.getElementById(rootId);
        if(!root) return false;

        root.setAttribute('data-autoplay', {{ section.settings.autoplay | json }} ? '1' : '0');

        var timeEl = document.getElementById("smwft-time-" + SECTION_ID);
        var statusEl = document.getElementById("smwft-status-" + SECTION_ID);
        if(!timeEl) return true;

        var loopMs = ({{ section.settings.duration_seconds | default: 10 }} * 1000) || 10000;
        var labels = [
          'Wir pr√ºfen dein <b>Motiv</b> ‚Ä¶',
          'Wir bauen deinen <b>Entwurf</b> ‚Ä¶',
          'Wir optimieren die <b>Konturen</b> ‚Ä¶',
          'Wir finalisieren das <b>Schild</b> ‚Ä¶'
        ];

        function pad(n){ return (n < 10 ? '0' : '') + n; }

        if(root.__smwftRAF) cancelAnimationFrame(root.__smwftRAF);

        function tick(){
          if(root.getAttribute('data-autoplay') !== '1') return;

          var now = Date.now();
          var phase = (now % loopMs) / loopMs;

          var seconds = Math.max(0, Math.round(120 * (1 - phase)));
          var mm = Math.floor(seconds / 60);
          var ss = seconds % 60;
          timeEl.textContent = pad(mm) + ':' + pad(ss);

          if(statusEl){
            var idx = Math.min(labels.length - 1, Math.floor(phase * labels.length));
            statusEl.innerHTML = labels[idx];
          }

          root.__smwftRAF = requestAnimationFrame(tick);
        }

        root.__smwftRAF = requestAnimationFrame(tick);
        return true;
      }

      function boot(){
        if(init()) return;
        var tries = 0;
        (function retry(){
          tries += 1;
          if(init()) return;
          if(tries > 80) return;
          requestAnimationFrame(retry);
        })();
      }

      if(document.readyState === "loading"){
        document.addEventListener("DOMContentLoaded", boot, { once: true });
      } else {
        boot();
      }

      document.addEventListener("shopify:section:load", function(e){
        if(!e || !e.detail || !e.detail.sectionId) return;
        if(String(e.detail.sectionId) === String(SECTION_ID)) boot();
      });
      document.addEventListener("shopify:section:select", function(e){
        if(!e || !e.detail || !e.detail.sectionId) return;
        if(String(e.detail.sectionId) === String(SECTION_ID)) boot();
      });
    })();
  </script>
</section>