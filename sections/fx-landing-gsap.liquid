<section class="fxl" data-fxl>
  <!-- Top left (only when header is hidden) -->
  <a class="fxl__shoplink" href="/collections/all" data-fxl-shoplink>Zum Shop</a>

  <!-- Top center logo on blurry background (only when header is hidden) -->
  <div class="fxl__toplogo" aria-hidden="true" data-fxl-toplogo>
    <img
      class="fxl__toplogoImg"
      src="https://lh3.googleusercontent.com/d/1XkLtxAbLzhNNeDv9emQGAdc5TAUNkAMb=s250"
      alt="Steelmonks"
      loading="lazy"
      decoding="async"
    />
  </div>

  <!-- Under-header “Verstecken” (only when header is shown, and we are in expanded mode) -->
  <button class="fxl__hidebar" type="button" data-fxl-hidebar aria-label="Header verstecken">Verstecken</button>

  <!-- Blurry background blobs (fade in only after Entwerfen) -->
  <div class="fxl__bg" aria-hidden="true">
    <div class="fxl__blob fxl__blob--1"></div>
    <div class="fxl__blob fxl__blob--2"></div>
    <div class="fxl__blob fxl__blob--3"></div>
  </div>

  <!-- STAGE 0: compact (page load) -->
  <div class="fxl__stage fxl__stage--compact" data-fxl-compact>
    <h1 class="fxl__compactTitle">Dein Schild als Metall Design</h1>
    <button class="fxl__btn-grad" type="button" data-fxl-expand>Entwerfen</button>
  </div>

  <!-- STAGE 1: form window (after Entwerfen) -->
  <div class="fxl__stage fxl__stage--form" data-fxl-form aria-hidden="true">
    <div class="fxl__card">
      <h2 class="fxl__title">Dein Schild als Metall Design</h2>
      <p class="fxl__sub">Lade ein Motiv hoch oder starte nur mit Text. Danach erstellen wir dein Design.</p>

      <div class="fxl__upload">
        <input class="fxl__file" type="file" accept="image/*" data-fxl-file />
        <div class="fxl__uploadBox" role="button" tabindex="0" data-fxl-fileui>
          <div class="fxl__uploadIcon">+</div>
          <div class="fxl__uploadTxt">
            <div class="fxl__uploadTitle">Motiv Upload</div>
            <div class="fxl__uploadSub" data-fxl-filename>PNG oder JPG, optional</div>
          </div>
        </div>
      </div>

      <label class="fxl__label" for="fxlText">DEIN TEXT</label>
      <textarea
        id="fxlText"
        class="fxl__textarea"
        rows="5"
        placeholder="z.B. Familienname Wagner, moderner Look, Labrador Silhouette, keine Schnörkel"
        data-fxl-text
      ></textarea>

      <button class="fxl__btn-grad fxl__btn-grad--wide" type="button" data-fxl-make>Entwurf erstellen</button>
    </div>
  </div>

  <!-- STAGE 2: preview window (after Entwurf erstellen) -->
  <div class="fxl__stage fxl__stage--preview" data-fxl-preview aria-hidden="true">
    <div class="fxl__card fxl__card--preview">
      <button class="fxl__x" type="button" data-fxl-closepreview aria-label="Schließen">✕</button>

      <div class="fxl__etaPill" aria-hidden="true">
        <span class="fxl__etaLbl">Geschätzte Zeit</span>
        <span class="fxl__etaTime" data-fxl-eta>02:30</span>
      </div>

      <div class="fxl__previewSquare">
        <div class="fxl__previewHint">VORSCHAU</div>
        <img class="fxl__previewImg" alt="Vorschau" loading="lazy" decoding="async" data-fxl-previewimg />
      </div>
    </div>

    <button class="fxl__btn-grad fxl__btn-grad--wide fxl__btn-grad--below" type="button" data-fxl-view>
      Schild ansehen
    </button>
  </div>
</section>

<style>
  .fxl{
    --fxl-ink:#090A0C;
    --fxl-paper:#FAFAFF;
    --fxl-blue:#123C9B;
    --fxl-navy:#0A1F4D;
    --fxl-orange:#C98A2B;

    --fxl-glass: rgba(255,255,255,0.66);
    --fxl-glass-b: rgba(9,10,12,0.10);
    --fxl-shadow: 0 24px 76px rgba(0,0,0,0.12);

    position:relative;
    overflow:hidden;
    background: linear-gradient(180deg, var(--fxl-paper), var(--fxl-paper));
    color: var(--fxl-ink);
    opacity:0;
    padding: 24px 16px 40px;
  }
  .fxl.fxl--ready{ opacity:1; transition: opacity 420ms ease; }

  /* expanded state becomes full screen and shows blobs */
  .fxl.fxl--expanded{
    min-height:100vh;
    padding: clamp(18px, 4vw, 54px);
    background:
      radial-gradient(1100px 720px at 18% 12%, rgba(0,68,204,0.16), transparent 58%),
      radial-gradient(980px 700px at 86% 22%, rgba(0,68,204,0.12), transparent 58%),
      radial-gradient(900px 650px at 55% 85%, rgba(0,68,204,0.10), transparent 60%),
      linear-gradient(180deg, var(--fxl-paper), var(--fxl-paper));
  }

  /* TOP: shop link (no pill) */
  .fxl__shoplink{
    position: fixed;
    top: 16px;
    left: 16px;
    z-index: 70;
    text-decoration:none;
    color: rgba(9,10,12,0.78);
    font-weight: 850;
    font-size: 14px;
    letter-spacing: 0.01em;
    padding: 12px 14px;
    border-radius: 14px;
    background: transparent;
    opacity:0;
    pointer-events:none;
    transition: opacity 320ms ease;
  }
  .fxl__shoplink:hover{ color: rgba(0,68,204,0.92); }

  /* centered logo on background */
  .fxl__toplogo{
    position: fixed;
    top: 26px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 70;
    opacity:0;
    pointer-events:none;
    transition: opacity 320ms ease, transform 320ms ease;
  }
  .fxl__toplogoImg{
    height: 28px;
    width: auto;
    display:block;
    opacity:0.92;
    filter: drop-shadow(0 10px 18px rgba(0,0,0,0.10));
  }

  /* show shoplink + logo only when expanded AND header is hidden */
  .fxl.fxl--expanded.fxl--chromeHidden .fxl__shoplink,
  .fxl.fxl--expanded.fxl--chromeHidden .fxl__toplogo{
    opacity:1;
    pointer-events:auto;
  }
  .fxl.fxl--expanded.fxl--chromeHidden .fxl__toplogo{
    transform: translateX(-50%) translateY(6px);
  }

  /* under-header verstecken */
  .fxl__hidebar{
    position: fixed;
    left: 50%;
    transform: translateX(-50%);
    top: 14px;
    z-index: 70;
    border: 1px solid rgba(9,10,12,0.12);
    background: rgba(255,255,255,0.70);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    color: rgba(9,10,12,0.78);
    font-weight: 900;
    font-size: 13px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 10px 14px;
    border-radius: 999px;
    box-shadow: 0 18px 46px rgba(0,0,0,0.10);
    opacity:0;
    pointer-events:none;
    transition: opacity 320ms ease;
  }
  .fxl.fxl--expanded.fxl--chromeShown .fxl__hidebar{
    opacity:1;
    pointer-events:auto;
  }

  /* Blobs */
  .fxl__bg{ position:absolute; inset:0; pointer-events:none; z-index:0; }
  .fxl__blob{
    position:absolute;
    width:min(70vmin, 760px);
    height:min(70vmin, 760px);
    border-radius:999px;
    opacity:0;
    filter: blur(74px);
    will-change: transform, opacity;
    mix-blend-mode: multiply;
    transform: translate3d(0,0,0) scale(1);
    transition: opacity 520ms ease;
  }
  .fxl.fxl--expanded .fxl__blob{ opacity:0.85; }
  .fxl.fxl--expanded.fxl--stage-compact .fxl__blob{ opacity:0; } /* keep off until click */

  .fxl__blob::after{
    content:"";
    position:absolute;
    inset:0;
    border-radius:999px;
    background: radial-gradient(circle at 32% 28%, rgba(255,255,255,0.74), rgba(255,255,255,0) 58%);
    opacity: 0.68;
  }
  .fxl__blob--1{
    left:-16vmin;
    top:-14vmin;
    background: radial-gradient(circle at 35% 35%, rgba(0,68,204,0.36), rgba(255,255,255,0.58) 52%, rgba(0,68,204,0.10) 70%, rgba(0,0,0,0) 78%);
  }
  .fxl__blob--2{
    right:-18vmin;
    top:6vmin;
    background: radial-gradient(circle at 40% 40%, rgba(0,68,204,0.28), rgba(255,255,255,0.64) 52%, rgba(0,68,204,0.12) 72%, rgba(0,0,0,0) 80%);
  }
  .fxl__blob--3{
    left:10vmin;
    bottom:-18vmin;
    background: radial-gradient(circle at 38% 38%, rgba(0,68,204,0.22), rgba(255,255,255,0.62) 52%, rgba(0,68,204,0.10) 72%, rgba(0,0,0,0) 80%);
  }

  /* Stages */
  .fxl__stage{
    position: relative;
    z-index: 1;
    display: grid;
    place-items: center;
    gap: 14px;
  }

  .fxl__stage--compact{
    padding: 38px 12px 22px;
  }
  .fxl__compactTitle{
    margin: 0;
    text-align: center;
    font-size: clamp(26px, 4.2vw, 40px);
    letter-spacing: -0.02em;
    line-height: 1.05;
  }

  .fxl__stage--form,
  .fxl__stage--preview{
    min-height: 100vh;
    padding: clamp(32px, 4vw, 70px) 12px 70px;
    opacity: 0;
    pointer-events: none;
    transform: translateY(10px);
    transition: opacity 420ms ease, transform 420ms ease;
  }
  .fxl.fxl--stage-form .fxl__stage--form,
  .fxl.fxl--stage-preview .fxl__stage--preview{
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }

  .fxl__stage--compact{
    opacity: 1;
    transform: translateY(0);
    transition: opacity 320ms ease, transform 320ms ease;
  }
  .fxl.fxl--stage-form .fxl__stage--compact,
  .fxl.fxl--stage-preview .fxl__stage--compact{
    opacity: 0;
    pointer-events: none;
    transform: translateY(-6px);
  }

  /* Card */
  .fxl__card{
    width: min(980px, 92vw);
    border-radius: 34px;
    background: rgba(255,255,255,0.60);
    border: 1px solid rgba(9,10,12,0.10);
    box-shadow: 0 34px 120px rgba(0,0,0,0.20);
    backdrop-filter: blur(22px);
    -webkit-backdrop-filter: blur(22px);
    padding: clamp(22px, 3.4vw, 44px);
    position: relative;
  }

  .fxl__title{
    margin: 0 0 10px;
    text-align:center;
    font-size: clamp(34px, 5.1vw, 64px);
    line-height: 1.02;
    letter-spacing: -0.02em;
  }
  .fxl__sub{
    margin: 0 auto 22px;
    max-width: 60ch;
    text-align:center;
    opacity:0.78;
    font-size: clamp(14px, 1.6vw, 18px);
    line-height: 1.45;
  }

  /* Upload row */
  .fxl__upload{ margin: 10px auto 18px; width: min(760px, 100%); }
  .fxl__file{ position:absolute; opacity:0; pointer-events:none; width:1px; height:1px; }
  .fxl__uploadBox{
    display:flex;
    align-items:center;
    gap: 16px;
    padding: 20px 20px;
    border-radius: 22px;
    background: rgba(255,255,255,0.72);
    border: 1px solid rgba(9,10,12,0.10);
    box-shadow: 0 24px 76px rgba(0,0,0,0.10);
    cursor:pointer;
    user-select:none;
  }
  .fxl__uploadIcon{
    width: 56px;
    height: 56px;
    border-radius: 16px;
    display:grid;
    place-items:center;
    font-weight: 950;
    font-size: 28px;
    color: rgba(0,68,204,0.78);
    background: rgba(0,68,204,0.08);
    border: 1px solid rgba(0,68,204,0.18);
    flex: 0 0 auto;
  }
  .fxl__uploadTitle{ font-weight: 950; font-size: 28px; line-height: 1.05; }
  .fxl__uploadSub{ margin-top: 6px; font-weight: 800; opacity: 0.75; font-size: 20px; }

  .fxl__label{
    display:block;
    width: min(760px, 100%);
    margin: 0 auto 10px;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    opacity: 0.70;
    font-weight: 950;
  }
  .fxl__textarea{
    width: min(760px, 100%);
    margin: 0 auto 22px;
    display:block;
    resize: vertical;
    min-height: 160px;
    border-radius: 22px;
    border: 1px solid rgba(9,10,12,0.12);
    background: rgba(255,255,255,0.72);
    padding: 16px 16px;
    font-size: 16px;
    line-height: 1.4;
    outline: none;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.90);
  }
  .fxl__textarea:focus{
    border-color: rgba(0,68,204,0.35);
    box-shadow: 0 0 0 4px rgba(0,68,204,0.10), inset 0 1px 0 rgba(255,255,255,0.92);
  }

  /* Gradient button like screenshot */
  .fxl__btn-grad{
    appearance:none;
    border: 0;
    height: 66px;
    padding: 0 26px;
    border-radius: 999px;
    font-weight: 950;
    font-size: 20px;
    letter-spacing: 0.01em;
    color: rgba(255,255,255,0.92);
    cursor: pointer;
    background: linear-gradient(90deg, var(--fxl-orange), var(--fxl-navy));
    box-shadow: 0 22px 64px rgba(0,0,0,0.22);
    transition: transform 160ms ease, box-shadow 220ms ease, filter 160ms ease, opacity 160ms ease;
    user-select:none;
  }
  .fxl__btn-grad:hover{ transform: translateY(-1px); box-shadow: 0 26px 74px rgba(0,0,0,0.26); }
  .fxl__btn-grad:active{ transform: translateY(0px) scale(0.99); }

  .fxl__btn-grad--wide{
    width: min(640px, 86vw);
    display:block;
    margin: 0 auto;
  }

  /* Preview stage specifics */
  .fxl__card--preview{
    width: min(880px, 92vw);
    padding-top: 58px;
  }

  .fxl__etaPill{
    position:absolute;
    top: 14px;
    left: 50%;
    transform: translateX(-50%);
    display:flex;
    align-items:center;
    gap: 12px;
    padding: 10px 12px;
    border-radius: 999px;
    background: rgba(255,255,255,0.72);
    border: 1px solid rgba(9,10,12,0.12);
    box-shadow: 0 18px 52px rgba(0,0,0,0.14);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
  }
  .fxl__etaLbl{
    font-weight: 950;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    font-size: 12px;
    opacity: 0.70;
  }
  .fxl__etaTime{
    padding: 8px 12px;
    border-radius: 999px;
    background: rgba(255,255,255,0.82);
    border: 1px solid rgba(0,68,204,0.18);
    color: rgba(0,68,204,0.92);
    font-weight: 950;
    letter-spacing: 0.08em;
    min-width: 76px;
    text-align:center;
  }

  .fxl__x{
    position:absolute;
    top: 14px;
    right: 14px;
    width: 44px;
    height: 44px;
    border-radius: 999px;
    border: 1px solid rgba(9,10,12,0.12);
    background: rgba(255,255,255,0.72);
    cursor:pointer;
    font-weight: 950;
    color: rgba(9,10,12,0.70);
    box-shadow: 0 18px 52px rgba(0,0,0,0.12);
  }

  .fxl__previewSquare{
    width: min(720px, 84vw);
    aspect-ratio: 1 / 1;
    border-radius: 28px;
    background: linear-gradient(180deg, rgba(9,10,12,0.06), rgba(9,10,12,0.02));
    border: 1px solid rgba(9,10,12,0.10);
    box-shadow: 0 28px 96px rgba(0,0,0,0.16);
    margin: 0 auto;
    display:grid;
    place-items:center;
    position:relative;
    overflow:hidden;
  }
  .fxl__previewHint{
    position:absolute;
    top: 50%;
    transform: translateY(-50%);
    font-weight: 950;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    font-size: 12px;
    opacity: 0.35;
  }
  .fxl__previewImg{
    width: 100%;
    height: 100%;
    object-fit: contain;
    display:block;
    opacity: 0;
    transition: opacity 220ms ease;
  }
  .fxl__previewImg.fxl__previewImg--on{ opacity: 1; }

  .fxl__btn-grad--below{
    margin-top: 22px;
  }

  /* CHROME: fixed, fade only, no layout shift */
  .fxl__chromeFixed{
    position: fixed !important;
    left: 0 !important;
    right: 0 !important;
    width: 100% !important;
    margin: 0 !important;
    z-index: 60 !important;
  }
  .fxl__chromeFixedTop{ top: 0 !important; }

  .fxl__chromeFade{
    opacity: 0 !important;
    pointer-events: none !important;
    visibility: hidden !important;
    transition: opacity 700ms ease !important;
    will-change: opacity !important;
  }
  .fxl__chromeFade.fxl__chromeFade--shown{
    opacity: 1 !important;
    pointer-events: auto !important;
    visibility: visible !important;
  }

  @media (max-width: 900px){
    .fxl__shoplink{ top: 12px; left: 12px; }
    .fxl__toplogo{ top: 30px; }
    .fxl__btn-grad{ height: 60px; font-size: 18px; }
    .fxl__uploadTitle{ font-size: 22px; }
    .fxl__uploadSub{ font-size: 16px; }
  }

  @media (prefers-reduced-motion: reduce){
    .fxl__blob{ transition:none; }
    .fxl__stage{ transition:none; }
    .fxl__shoplink, .fxl__toplogo, .fxl__hidebar{ transition:none; }
  }
</style>

<script>
(function(){
  function uniq(arr){ return Array.from(new Set(arr)); }

  function getHeaderTargets(){
    const selectors = [
      "#shopify-section-announcement-bar",
      ".announcement-bar-section",
      "[data-section-type='announcement-bar']",
      "#shopify-section-header",
      ".shopify-section-header-sticky",
      "[data-section-type='header']"
    ];
    const nodes = [];
    selectors.forEach(sel => document.querySelectorAll(sel).forEach(n => nodes.push(n)));
    document.querySelectorAll("section[id^='shopify-section-'], div[id^='shopify-section-']").forEach(sec => {
      if(sec.querySelector && sec.querySelector("header, .header-wrapper, .announcement-bar, .utility-bar")) nodes.push(sec);
    });
    return uniq(nodes);
  }

  function safeMaxHeight(els){
    if(!els || !els.length) return 0;
    let m = 0;
    els.forEach(el => {
      if(!el || el.nodeType !== 1) return;
      const r = el.getBoundingClientRect();
      const h = Math.round(r.height || 0);
      if(h > m) m = h;
    });
    return isFinite(m) ? m : 0;
  }

  function setTargetsVisible(targets, visible, opts){
    const topOffset = (opts && typeof opts.top === "number") ? opts.top : 0;

    targets.forEach(el => {
      if(!el || el.nodeType !== 1) return;

      if(el.dataset.fxlChromeInit !== "1"){
        el.dataset.fxlChromeInit = "1";
        el.classList.add("fxl__chromeFixed");
        el.classList.add("fxl__chromeFixedTop");
        el.classList.add("fxl__chromeFade");
      }

      el.style.top = topOffset + "px";

      if(visible){
        el.classList.add("fxl__chromeFade--shown");
        el.setAttribute("aria-hidden","false");
      } else {
        el.classList.remove("fxl__chromeFade--shown");
        el.setAttribute("aria-hidden","true");
      }
    });
  }

  function fmtMMSS(ms){
    var s = Math.max(0, Math.ceil(ms / 1000));
    var m = Math.floor(s / 60);
    var r = s % 60;
    return String(m).padStart(2,"0") + ":" + String(r).padStart(2,"0");
  }

  function boot(){
    const root = document.querySelector("[data-fxl]");
    if(!root) return;

    const btnExpand = root.querySelector("[data-fxl-expand]");
    const shopLink = root.querySelector("[data-fxl-shoplink]");
    const hideBar = root.querySelector("[data-fxl-hidebar]");

    const stageForm = root.querySelector("[data-fxl-form]");
    const stagePreview = root.querySelector("[data-fxl-preview]");

    const file = root.querySelector("[data-fxl-file]");
    const fileUi = root.querySelector("[data-fxl-fileui]");
    const fileName = root.querySelector("[data-fxl-filename]");

    const btnMake = root.querySelector("[data-fxl-make]");
    const btnView = root.querySelector("[data-fxl-view]");
    const btnClosePreview = root.querySelector("[data-fxl-closepreview]");

    const etaEl = root.querySelector("[data-fxl-eta]");
    const prevImg = root.querySelector("[data-fxl-previewimg]");

    if(!btnExpand || !shopLink || !hideBar || !stageForm || !stagePreview || !btnMake) return;

    // ready
    requestAnimationFrame(() => root.classList.add("fxl--ready"));

    // state
    let expanded = false;
    let chromeShown = true; // on page load: header visible
    let headerTargets = getHeaderTargets();

    // split header targets: bars + main
    const bars = headerTargets.filter(el =>
      el.matches("#shopify-section-announcement-bar, .announcement-bar-section, [data-section-type='announcement-bar'], .utility-bar, .utility-bar__inner") ||
      (el.querySelector && el.querySelector(".announcement-bar, .utility-bar"))
    );
    const headerMain = headerTargets.filter(el => !bars.includes(el));

    function applyChromeState(){
      if(!expanded){
        root.classList.remove("fxl--chromeHidden");
        root.classList.remove("fxl--chromeShown");
        return;
      }
      if(chromeShown){
        root.classList.add("fxl--chromeShown");
        root.classList.remove("fxl--chromeHidden");
      } else {
        root.classList.add("fxl--chromeHidden");
        root.classList.remove("fxl--chromeShown");
      }
    }

    function showHeader(){
      chromeShown = true;
      const barsH = safeMaxHeight(bars);
      setTargetsVisible(bars, true, { top: 0 });
      setTargetsVisible(headerMain, true, { top: barsH });
      applyChromeState();
    }

    function hideHeader(){
      chromeShown = false;
      const barsH = safeMaxHeight(bars);
      setTargetsVisible(bars, false, { top: 0 });
      setTargetsVisible(headerMain, false, { top: barsH });
      applyChromeState();
    }

    function goStage(name){
      root.classList.remove("fxl--stage-compact","fxl--stage-form","fxl--stage-preview");
      root.classList.add("fxl--stage-" + name);
      stageForm.setAttribute("aria-hidden", name === "form" ? "false" : "true");
      stagePreview.setAttribute("aria-hidden", name === "preview" ? "false" : "true");
    }

    // initial stage compact
    root.classList.add("fxl--stage-compact");

    // file UI
    function openFile(){
      if(file) file.click();
    }
    function syncFile(){
      if(!fileName) return;
      if(file && file.files && file.files[0]){
        fileName.textContent = file.files[0].name;
      } else {
        fileName.textContent = "PNG oder JPG, optional";
      }
    }
    if(fileUi){
      fileUi.addEventListener("click", openFile);
      fileUi.addEventListener("keydown", (e) => {
        if(e.key === "Enter" || e.key === " ") { e.preventDefault(); openFile(); }
      });
    }
    if(file){
      file.addEventListener("change", syncFile);
    }

    // timer
    let etaTick = null;
    let etaEndsAt = 0;
    function stopEta(){
      if(etaTick) clearInterval(etaTick);
      etaTick = null;
      etaEndsAt = 0;
    }
    function startEta(ms){
      stopEta();
      etaEndsAt = Date.now() + ms;
      function tick(){
        const left = etaEndsAt - Date.now();
        if(etaEl) etaEl.textContent = fmtMMSS(left);
        if(left <= 0){
          if(etaEl) etaEl.textContent = "00:00";
          stopEta();
        }
      }
      tick();
      etaTick = setInterval(tick, 1000);
    }

    // actions
    btnExpand.addEventListener("click", () => {
      expanded = true;
      root.classList.add("fxl--expanded");
      // blobs should fade in only after click
      root.classList.remove("fxl--stage-compact");
      root.classList.add("fxl--stage-form");

      // fade out header, show top logo + shop link
      hideHeader();

      // give the logo a bit more top padding feel by keeping it lower after shown (CSS translateY)
      goStage("form");
    });

    // Zum Shop: show header again, hide logo/shoplink via classes, and show “Verstecken” under header
    shopLink.addEventListener("click", (e) => {
      e.preventDefault();
      if(!expanded) return;
      showHeader();
    });

    // Verstecken: hide header again
    hideBar.addEventListener("click", () => {
      if(!expanded) return;
      hideHeader();
    });

    // Entwurf erstellen -> preview stage
    btnMake.addEventListener("click", () => {
      if(!expanded) return;

      // swap windows
      goStage("preview");

      // start timer (02:30)
      startEta(150000);

      // demo: if user uploaded, show it as preview image, otherwise keep empty
      try{
        if(file && file.files && file.files[0] && prevImg){
          const url = URL.createObjectURL(file.files[0]);
          prevImg.src = url;
          prevImg.classList.add("fxl__previewImg--on");
        }
      }catch(_e){}
    });

    // close preview -> back to form
    if(btnClosePreview){
      btnClosePreview.addEventListener("click", () => {
        stopEta();
        goStage("form");
      });
    }

    // Schild ansehen (hook for your real logic)
    if(btnView){
      btnView.addEventListener("click", () => {
        // keep as no-op; connect to your creator flow later
      });
    }

    // If section reloads in theme editor
    document.addEventListener("shopify:section:load", () => {
      headerTargets = getHeaderTargets();
    });

    syncFile();
    applyChromeState();
  }

  if(document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", boot);
  } else {
    boot();
  }
})();
</script>

{% schema %}
{
  "name": "Heavenly FX Landing v2",
  "settings": []
}
{% endschema %}