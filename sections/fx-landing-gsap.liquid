<section class="fxl" data-fxl>
  <a class="fxl__shoplink" href="/collections/all" data-fxl-shoplink>Zum Shop</a>

  <div class="fxl__toplogo" aria-hidden="true" data-fxl-toplogo>
    <img
      class="fxl__toplogoImg"
      src="https://lh3.googleusercontent.com/d/1XkLtxAbLzhNNeDv9emQGAdc5TAUNkAMb=s250"
      alt="Steelmonks"
      loading="lazy"
      decoding="async"
    />
  </div>

  <!-- UNDER header (position only), does NOT affect content layout -->
  <button class="fxl__hidebar" type="button" data-fxl-hidebar aria-label="Header verstecken">Verstecken</button>

  <div class="fxl__bg" aria-hidden="true">
    <div class="fxl__blob fxl__blob--1"></div>
    <div class="fxl__blob fxl__blob--2"></div>
    <div class="fxl__blob fxl__blob--3"></div>
  </div>

  <!-- COMPACT (on load) -->
  <div class="fxl__stage fxl__stage--compact" data-fxl-compact aria-hidden="false">
    <h1 class="fxl__compactTitle">Dein Schild als Metall Design</h1>
    <button class="fxl__btn-grad" type="button" data-fxl-expand>Entwerfen</button>
  </div>

  <!-- FORM (after Entwerfen) -->
  <div class="fxl__stage fxl__stage--form" data-fxl-form aria-hidden="true">
    <div class="fxl__float">
      <div class="fxl__card">
        <h2 class="fxl__title">Dein Schild als Metall Design</h2>
        <p class="fxl__sub">Lade ein Motiv hoch oder starte nur mit Text. Danach erstellen wir dein Design.</p>

        <div class="fxl__upload">
          <input class="fxl__file" type="file" accept="image/*" data-fxl-file>
          <div class="fxl__uploadBox" role="button" tabindex="0" data-fxl-fileui>
            <div class="fxl__uploadIcon">+</div>
            <div class="fxl__uploadTxt">
              <div class="fxl__uploadTitle">Motiv Upload</div>
              <div class="fxl__uploadSub" data-fxl-filename>PNG oder JPG, optional</div>
            </div>
          </div>
        </div>

        <label class="fxl__label" for="fxlText">DEIN TEXT</label>
        <textarea
          id="fxlText"
          class="fxl__textarea"
          rows="5"
          placeholder="z.B. Familienname Wagner, moderner Look, Labrador Silhouette, keine Schnörkel"
          data-fxl-text
        ></textarea>

        <button class="fxl__btn-grad fxl__btn-grad--wide" type="button" data-fxl-make>Entwurf erstellen</button>
      </div>
    </div>
  </div>

  <!-- PREVIEW (after Entwurf erstellen) -->
  <div class="fxl__stage fxl__stage--preview" data-fxl-preview aria-hidden="true">
    <div class="fxl__float">
      <div class="fxl__card fxl__card--preview">
        <button class="fxl__x" type="button" data-fxl-closepreview aria-label="Schließen">✕</button>

        <div class="fxl__etaPill" aria-hidden="true">
          <span class="fxl__etaLbl">Geschätzte Zeit</span>
          <span class="fxl__etaTime" data-fxl-eta>02:30</span>
        </div>

        <div class="fxl__previewSquare">
          <div class="fxl__previewHint">VORSCHAU</div>
          <img class="fxl__previewImg" alt="Vorschau" loading="lazy" decoding="async" data-fxl-previewimg>
        </div>
      </div>

      <button class="fxl__btn-grad fxl__btn-grad--wide" type="button" data-fxl-view>
        Schild ansehen
      </button>
    </div>
  </div>
</section>

<style>
  .fxl{
    --fxl-paper:#FAFAFF;
    --fxl-ink:#090A0C;
    --fxl-navy:#0A1F4D;
    --fxl-orange:#C98A2B;

    /* set by JS for positioning the "Verstecken" button only */
    --fxl-headerH: 0px;

    position:relative;
    overflow:hidden;
    background: linear-gradient(180deg, var(--fxl-paper), var(--fxl-paper));
    color: var(--fxl-ink);
    opacity:0;
    padding: 0;
    min-height: 100vh;
  }
  .fxl.fxl--ready{ opacity:1; transition: opacity 420ms ease; }

  .fxl__shoplink{
    position: fixed;
    top: 16px;
    left: 16px;
    z-index: 70;
    text-decoration:none;
    color: rgba(9,10,12,0.78);
    font-weight: 850;
    font-size: 14px;
    padding: 12px 14px;
    border-radius: 14px;
    background: transparent;
    opacity:0;
    pointer-events:none;
    transition: opacity 380ms ease;
  }
  .fxl__shoplink:hover{ color: rgba(0,68,204,0.92); }

  .fxl__toplogo{
    position: fixed;
    top: 34px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 70;
    opacity:0;
    pointer-events:none;
    transition: opacity 380ms ease, transform 380ms ease;
  }
  .fxl__toplogoImg{
    height: 28px;
    width: auto;
    display:block;
    opacity:0.92;
    filter: drop-shadow(0 10px 18px rgba(0,0,0,0.10));
  }

  .fxl__hidebar{
    position: fixed;
    left: 50%;
    transform: translateX(-50%);
    top: calc(var(--fxl-headerH) + 10px);
    z-index: 70;
    border: 1px solid rgba(9,10,12,0.12);
    background: rgba(255,255,255,0.70);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    color: rgba(9,10,12,0.78);
    font-weight: 900;
    font-size: 13px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 10px 14px;
    border-radius: 999px;
    box-shadow: 0 18px 46px rgba(0,0,0,0.10);
    opacity:0;
    pointer-events:none;
    transition: opacity 380ms ease;
  }

  /* expanded + header hidden => show shop link + top logo */
  .fxl.fxl--chromeHidden .fxl__shoplink,
  .fxl.fxl--chromeHidden .fxl__toplogo{
    opacity:1;
    pointer-events:auto;
  }
  .fxl.fxl--chromeHidden .fxl__toplogo{
    transform: translateX(-50%) translateY(8px);
  }

  /* expanded + header shown => show "Verstecken" under header */
  .fxl.fxl--chromeShown .fxl__hidebar{
    opacity:1;
    pointer-events:auto;
  }

  .fxl__bg{ position:absolute; inset:0; pointer-events:none; z-index:0; }
  .fxl__blob{
    position:absolute;
    width:min(70vmin, 760px);
    height:min(70vmin, 760px);
    border-radius:999px;
    opacity:0;
    filter: blur(74px);
    will-change: transform, opacity;
    mix-blend-mode: multiply;
    transform: scale(0.98);
    transition: opacity 900ms ease, transform 900ms ease;
  }
  .fxl.fxl--expanded .fxl__blob{
    opacity:0.85;
    transform: scale(1);
  }

  .fxl__blob::after{
    content:"";
    position:absolute;
    inset:0;
    border-radius:999px;
    background: radial-gradient(circle at 32% 28%, rgba(255,255,255,0.74), rgba(255,255,255,0) 58%);
    opacity: 0.68;
  }
  .fxl__blob--1{
    left:-16vmin; top:-14vmin;
    background: radial-gradient(circle at 35% 35%, rgba(0,68,204,0.36), rgba(255,255,255,0.58) 52%, rgba(0,68,204,0.10) 70%, rgba(0,0,0,0) 78%);
  }
  .fxl__blob--2{
    right:-18vmin; top:6vmin;
    background: radial-gradient(circle at 40% 40%, rgba(0,68,204,0.28), rgba(255,255,255,0.64) 52%, rgba(0,68,204,0.12) 72%, rgba(0,0,0,0) 80%);
  }
  .fxl__blob--3{
    left:10vmin; bottom:-18vmin;
    background: radial-gradient(circle at 38% 38%, rgba(0,68,204,0.22), rgba(255,255,255,0.62) 52%, rgba(0,68,204,0.10) 72%, rgba(0,0,0,0) 80%);
  }

  /* STAGES are fixed, centered, independent of header (no layout shift) */
  .fxl__stage{
    position: fixed;
    inset: 0;
    z-index: 1;
    display: grid;
    place-items: center;
    padding: clamp(18px, 4vw, 54px);
    pointer-events: none;
  }

  .fxl__float{
    width: 100%;
    display:flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 18px;
    pointer-events: auto;
  }

  .fxl__stage--compact{ pointer-events: auto; opacity: 1; transform: translateY(0); transition: opacity 520ms ease, transform 520ms ease; }

  .fxl__compactTitle{
    margin: 0 0 10px;
    text-align: center;
    font-size: clamp(26px, 4.2vw, 40px);
    letter-spacing: -0.02em;
    line-height: 1.05;
  }

  .fxl__stage--form,
  .fxl__stage--preview{
    opacity: 0;
    pointer-events: none;
    transform: translateY(12px);
    transition: opacity 520ms ease, transform 520ms ease;
  }

  .fxl.fxl--stage-form .fxl__stage--form,
  .fxl.fxl--stage-preview .fxl__stage--preview{
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }

  .fxl.fxl--stage-form .fxl__stage--compact,
  .fxl.fxl--stage-preview .fxl__stage--compact{
    opacity: 0;
    pointer-events: none;
    transform: translateY(-8px);
  }

  /* content "expand" feel */
  .fxl__stage--form .fxl__card,
  .fxl__stage--preview .fxl__card{
    transform: scale(0.985);
    opacity: 0;
    filter: blur(2px);
    transition: transform 720ms ease, opacity 720ms ease, filter 720ms ease;
  }
  .fxl.fxl--stage-form .fxl__stage--form .fxl__card,
  .fxl.fxl--stage-preview .fxl__stage--preview .fxl__card{
    transform: scale(1);
    opacity: 1;
    filter: blur(0px);
  }

  .fxl__card{
    width: min(900px, 92vw);
    border-radius: 34px;
    background: rgba(255,255,255,0.60);
    border: 1px solid rgba(9,10,12,0.10);
    box-shadow: 0 34px 120px rgba(0,0,0,0.20);
    backdrop-filter: blur(22px);
    -webkit-backdrop-filter: blur(22px);
    padding: clamp(22px, 3.4vw, 44px);
    position: relative;
  }

  .fxl__title{
    margin: 0 0 10px;
    text-align:center;
    font-size: clamp(34px, 5.1vw, 64px);
    line-height: 1.02;
    letter-spacing: -0.02em;
  }
  .fxl__sub{
    margin: 0 auto 22px;
    max-width: 60ch;
    text-align:center;
    opacity:0.78;
    font-size: clamp(14px, 1.6vw, 18px);
    line-height: 1.45;
  }

  .fxl__upload{ margin: 10px auto 18px; width: min(760px, 100%); }
  .fxl__file{ position:absolute; opacity:0; pointer-events:none; width:1px; height:1px; }
  .fxl__uploadBox{
    display:flex; align-items:center; gap: 16px;
    padding: 20px 20px;
    border-radius: 22px;
    background: rgba(255,255,255,0.72);
    border: 1px solid rgba(9,10,12,0.10);
    box-shadow: 0 24px 76px rgba(0,0,0,0.10);
    cursor:pointer;
  }
  .fxl__uploadIcon{
    width: 56px; height: 56px;
    border-radius: 16px;
    display:grid; place-items:center;
    font-weight: 950; font-size: 28px;
    color: rgba(0,68,204,0.78);
    background: rgba(0,68,204,0.08);
    border: 1px solid rgba(0,68,204,0.18);
    flex: 0 0 auto;
  }
  .fxl__uploadTitle{ font-weight: 950; font-size: 28px; line-height: 1.05; }
  .fxl__uploadSub{ margin-top: 6px; font-weight: 800; opacity: 0.75; font-size: 20px; }

  .fxl__label{
    display:block;
    width: min(760px, 100%);
    margin: 0 auto 10px;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    opacity: 0.70;
    font-weight: 950;
  }
  .fxl__textarea{
    width: min(760px, 100%);
    margin: 0 auto 22px;
    display:block;
    resize: vertical;
    min-height: 160px;
    border-radius: 22px;
    border: 1px solid rgba(9,10,12,0.12);
    background: rgba(255,255,255,0.72);
    padding: 16px 16px;
    font-size: 16px;
    line-height: 1.4;
    outline: none;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.90);
  }
  .fxl__textarea:focus{
    border-color: rgba(0,68,204,0.35);
    box-shadow: 0 0 0 4px rgba(0,68,204,0.10), inset 0 1px 0 rgba(255,255,255,0.92);
  }

  .fxl__btn-grad{
    appearance:none;
    border: 0;
    height: 66px;
    padding: 0 26px;
    border-radius: 999px;
    font-weight: 950;
    font-size: 20px;
    color: rgba(255,255,255,0.92);
    cursor: pointer;
    background: linear-gradient(90deg, var(--fxl-orange), var(--fxl-navy));
    box-shadow: 0 22px 64px rgba(0,0,0,0.22);
    transition: transform 160ms ease, box-shadow 220ms ease, opacity 220ms ease;
  }
  .fxl__btn-grad:hover{ transform: translateY(-1px); box-shadow: 0 26px 74px rgba(0,0,0,0.26); }
  .fxl__btn-grad:active{ transform: translateY(0px) scale(0.99); }
  .fxl__btn-grad--wide{ width: min(640px, 86vw); display:block; }

  .fxl__card--preview{ padding-top: 58px; }

  .fxl__etaPill{
    position:absolute;
    top: 14px;
    left: 50%;
    transform: translateX(-50%);
    display:flex;
    align-items:center;
    gap: 12px;
    padding: 10px 12px;
    border-radius: 999px;
    background: rgba(255,255,255,0.72);
    border: 1px solid rgba(9,10,12,0.12);
    box-shadow: 0 18px 52px rgba(0,0,0,0.14);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
  }
  .fxl__etaLbl{
    font-weight: 950;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    font-size: 12px;
    opacity: 0.70;
  }
  .fxl__etaTime{
    padding: 8px 12px;
    border-radius: 999px;
    background: rgba(255,255,255,0.82);
    border: 1px solid rgba(0,68,204,0.18);
    color: rgba(0,68,204,0.92);
    font-weight: 950;
    letter-spacing: 0.08em;
    min-width: 76px;
    text-align:center;
  }

  .fxl__x{
    position:absolute;
    top: 14px;
    right: 14px;
    width: 44px;
    height: 44px;
    border-radius: 999px;
    border: 1px solid rgba(9,10,12,0.12);
    background: rgba(255,255,255,0.72);
    cursor:pointer;
    font-weight: 950;
    color: rgba(9,10,12,0.70);
    box-shadow: 0 18px 52px rgba(0,0,0,0.12);
  }

  .fxl__previewSquare{
    width: min(720px, 84vw);
    aspect-ratio: 1 / 1;
    border-radius: 28px;
    background: linear-gradient(180deg, rgba(9,10,12,0.06), rgba(9,10,12,0.02));
    border: 1px solid rgba(9,10,12,0.10);
    box-shadow: 0 28px 96px rgba(0,0,0,0.16);
    margin: 0 auto;
    display:grid;
    place-items:center;
    position:relative;
    overflow:hidden;
  }
  .fxl__previewHint{
    position:absolute;
    top: 50%;
    transform: translateY(-50%);
    font-weight: 950;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    font-size: 12px;
    opacity: 0.35;
  }
  .fxl__previewImg{
    width: 100%;
    height: 100%;
    object-fit: contain;
    display:block;
    opacity: 0;
    transition: opacity 220ms ease;
  }
  .fxl__previewImg.fxl__previewImg--on{ opacity: 1; }

  /* CHROME: fixed, fade only */
  .fxl__chromeFixed{
    position: fixed !important;
    left: 0 !important;
    right: 0 !important;
    width: 100% !important;
    margin: 0 !important;
    z-index: 60 !important;
  }
  .fxl__chromeFixedTop{ top: 0 !important; }
  .fxl__chromeFade{
    opacity: 0 !important;
    pointer-events: none !important;
    visibility: hidden !important;
    transition: opacity 900ms ease !important;
    will-change: opacity !important;
  }
  .fxl__chromeFade.fxl__chromeFade--shown{
    opacity: 1 !important;
    pointer-events: auto !important;
    visibility: visible !important;
  }

  @media (max-width: 900px){
    .fxl__toplogo{ top: 28px; }
    .fxl__btn-grad{ height: 62px; font-size: 18px; }
  }
</style>

<script>
(function(){
  function uniq(arr){ return Array.from(new Set(arr)); }

  function getHeaderTargets(){
    const selectors = [
      "#shopify-section-announcement-bar",
      ".announcement-bar-section",
      "[data-section-type='announcement-bar']",
      "#shopify-section-header",
      ".shopify-section-header-sticky",
      "[data-section-type='header']"
    ];
    const nodes = [];
    selectors.forEach(sel => document.querySelectorAll(sel).forEach(n => nodes.push(n)));
    document.querySelectorAll("section[id^='shopify-section-'], div[id^='shopify-section-']").forEach(sec => {
      if(sec.querySelector && sec.querySelector("header, .header-wrapper, .announcement-bar, .utility-bar")) nodes.push(sec);
    });
    return uniq(nodes);
  }

  function safeMaxHeight(els){
    if(!els || !els.length) return 0;
    let m = 0;
    els.forEach(el => {
      if(!el || el.nodeType !== 1) return;
      const r = el.getBoundingClientRect();
      const h = Math.round(r.height || 0);
      if(h > m) m = h;
    });
    return isFinite(m) ? m : 0;
  }

  function setTargetsVisible(targets, visible, opts){
    const topOffset = (opts && typeof opts.top === "number") ? opts.top : 0;
    targets.forEach(el => {
      if(!el || el.nodeType !== 1) return;
      if(el.dataset.fxlChromeInit !== "1"){
        el.dataset.fxlChromeInit = "1";
        el.classList.add("fxl__chromeFixed");
        el.classList.add("fxl__chromeFixedTop");
        el.classList.add("fxl__chromeFade");
      }
      el.style.top = topOffset + "px";
      if(visible){
        el.classList.add("fxl__chromeFade--shown");
        el.setAttribute("aria-hidden","false");
      } else {
        el.classList.remove("fxl__chromeFade--shown");
        el.setAttribute("aria-hidden","true");
      }
    });
  }

  function fmtMMSS(ms){
    var s = Math.max(0, Math.ceil(ms / 1000));
    var m = Math.floor(s / 60);
    var r = s % 60;
    return String(m).padStart(2,"0") + ":" + String(r).padStart(2,"0");
  }

  function boot(){
    const root = document.querySelector("[data-fxl]");
    if(!root) return;

    const btnExpand = root.querySelector("[data-fxl-expand]");
    const shopLink = root.querySelector("[data-fxl-shoplink]");
    const hideBar = root.querySelector("[data-fxl-hidebar]");
    const compactEl = root.querySelector("[data-fxl-compact]");

    const stageForm = root.querySelector("[data-fxl-form]");
    const stagePreview = root.querySelector("[data-fxl-preview]");

    const file = root.querySelector("[data-fxl-file]");
    const fileUi = root.querySelector("[data-fxl-fileui]");
    const fileName = root.querySelector("[data-fxl-filename]");

    const btnMake = root.querySelector("[data-fxl-make]");
    const btnView = root.querySelector("[data-fxl-view]");
    const btnClosePreview = root.querySelector("[data-fxl-closepreview]");

    const etaEl = root.querySelector("[data-fxl-eta]");
    const prevImg = root.querySelector("[data-fxl-previewimg]");

    if(!btnExpand || !shopLink || !hideBar || !stageForm || !stagePreview || !btnMake || !compactEl) return;

    requestAnimationFrame(() => root.classList.add("fxl--ready"));

    // hard reset to avoid starting expanded when old classes remain
    root.classList.remove("fxl--expanded","fxl--chromeHidden","fxl--chromeShown","fxl--stage-form","fxl--stage-preview");
    root.classList.add("fxl--stage-compact");
    stageForm.setAttribute("aria-hidden","true");
    stagePreview.setAttribute("aria-hidden","true");
    compactEl.setAttribute("aria-hidden","false");

    let expanded = false;
    let chromeShown = true;

    let headerTargets = getHeaderTargets();
    const bars = headerTargets.filter(el =>
      el.matches("#shopify-section-announcement-bar, .announcement-bar-section, [data-section-type='announcement-bar'], .utility-bar, .utility-bar__inner") ||
      (el.querySelector && el.querySelector(".announcement-bar, .utility-bar"))
    );
    const headerMain = headerTargets.filter(el => !bars.includes(el));

    function setHeaderHeightVar(){
      const barsH = safeMaxHeight(bars);
      const mainH = safeMaxHeight(headerMain);
      root.style.setProperty("--fxl-headerH", (barsH + mainH) + "px");
    }

    function applyChromeState(){
      if(!expanded){
        root.classList.remove("fxl--expanded","fxl--chromeHidden","fxl--chromeShown");
        return;
      }
      if(chromeShown){
        root.classList.add("fxl--chromeShown");
        root.classList.remove("fxl--chromeHidden");
      } else {
        root.classList.add("fxl--chromeHidden");
        root.classList.remove("fxl--chromeShown");
      }
      setHeaderHeightVar();
    }

    function showHeader(){
      chromeShown = true;
      const barsH = safeMaxHeight(bars);
      setTargetsVisible(bars, true, { top: 0 });
      setTargetsVisible(headerMain, true, { top: barsH });
      applyChromeState();
    }

    function hideHeader(){
      chromeShown = false;
      const barsH = safeMaxHeight(bars);
      setTargetsVisible(bars, false, { top: 0 });
      setTargetsVisible(headerMain, false, { top: barsH });
      applyChromeState();
    }

    function goStage(name){
      root.classList.remove("fxl--stage-compact","fxl--stage-form","fxl--stage-preview");
      root.classList.add("fxl--stage-" + name);

      const isCompact = name === "compact";
      const isForm = name === "form";
      const isPreview = name === "preview";

      compactEl.setAttribute("aria-hidden", isCompact ? "false" : "true");
      stageForm.setAttribute("aria-hidden", isForm ? "false" : "true");
      stagePreview.setAttribute("aria-hidden", isPreview ? "false" : "true");
    }

    function openFile(){ if(file) file.click(); }
    function syncFile(){
      if(!fileName) return;
      if(file && file.files && file.files[0]) fileName.textContent = file.files[0].name;
      else fileName.textContent = "PNG oder JPG, optional";
    }
    if(fileUi){
      fileUi.addEventListener("click", openFile);
      fileUi.addEventListener("keydown", (e) => {
        if(e.key === "Enter" || e.key === " ") { e.preventDefault(); openFile(); }
      });
    }
    if(file) file.addEventListener("change", syncFile);

    let etaTick = null;
    let etaEndsAt = 0;
    function stopEta(){
      if(etaTick) clearInterval(etaTick);
      etaTick = null;
      etaEndsAt = 0;
    }
    function startEta(ms){
      stopEta();
      etaEndsAt = Date.now() + ms;
      function tick(){
        const left = etaEndsAt - Date.now();
        if(etaEl) etaEl.textContent = fmtMMSS(left);
        if(left <= 0){
          if(etaEl) etaEl.textContent = "00:00";
          stopEta();
        }
      }
      tick();
      etaTick = setInterval(tick, 1000);
    }

    // ENTWERFEN: expand + hide header + show form
    btnExpand.addEventListener("click", () => {
      expanded = true;
      root.classList.add("fxl--expanded");
      goStage("form");

      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          hideHeader();
          applyChromeState();
        });
      });
    });

    // ZUM SHOP: show header (hides shop link + logo automatically)
    shopLink.addEventListener("click", (e) => {
      e.preventDefault();
      if(!expanded) return;
      showHeader();
    });

    // VERSTECKEN: hide header (no layout shift, content stays fixed)
    hideBar.addEventListener("click", () => {
      if(!expanded) return;
      hideHeader();
    });

    // ENTWURF ERSTELLEN -> PREVIEW
    btnMake.addEventListener("click", () => {
      if(!expanded) return;
      goStage("preview");
      startEta(150000);

      try{
        if(file && file.files && file.files[0] && prevImg){
          const url = URL.createObjectURL(file.files[0]);
          prevImg.src = url;
          prevImg.classList.add("fxl__previewImg--on");
        }
      }catch(_e){}
    });

    // X in preview -> back to form
    if(btnClosePreview){
      btnClosePreview.addEventListener("click", () => {
        stopEta();
        goStage("form");
      });
    }
    if(btnView){
      btnView.addEventListener("click", () => {});
    }

    window.addEventListener("resize", () => setHeaderHeightVar(), { passive:true });

    syncFile();
    setHeaderHeightVar();
    applyChromeState();
    goStage("compact");
  }

  if(document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", boot);
  } else {
    boot();
  }
  document.addEventListener("shopify:section:load", boot);
})();
</script>

{% schema %}
{
  "name": "Heavenly FX Landing",
  "settings": []
}
{% endschema %}