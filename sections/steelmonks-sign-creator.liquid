{% comment %} * Variables {% endcomment %}
{% assign sid = section.id %}

{% comment %} * Assets {% endcomment %}
{{ 'steelmonks-sign-creator.css' | asset_url | stylesheet_tag }}
<script>
  var sid = '{{ sid }}';
</script>
<script src='{{ 'steelmonks-sign-creator.js' | asset_url }}' defer='defer'></script>

{% comment %} * HTML Markup {% endcomment %}
{% comment %} ! Open button {% endcomment %}
<div class='werkstatt-shadow-wrap twcss-mx-auto twcss-w-fit'>
  <button
    id='smc-open-btn'
    class='werkstatt-btn twcss-py-3 twcss-px-5 twcss-border-transparent twcss-bg-brandblack hover:twcss-bg-brandblack/50 twcss-transition-all twcss-duration-300 twcss-text-brandwhite twcss-shadow-xl hover:twcss-shadow-brandblack/25 twcss-rounded-full twcss-text-lg twcss-relative twcss-z-10'
  >
    In die Werkstatt
  </button>
</div>

{% comment %} ! Main container {% endcomment %}
<section
  id='smc-container'
  class='smc'
  aria-label='Steelmonks Creator'
  style='opacity: 0; visibility: hidden;'
  aria-hidden='true'
>
  {% comment %} ! Navigation & Status Pill {% endcomment %}
  <div class='twcss-flex twcss-gap-4 twcss-justify-center twcss-relative twcss-z-20'>
    {% comment %} ! STATUS PILL {% endcomment %}
    <div
      id='smc-pill'
      data-state='idle'
      aria-live='polite'
      class='twcss-inline-flex twcss-items-center twcss-justify-center twcss-gap-4 twcss-py-3 twcss-px-5 twcss-rounded-full twcss-bg-[rgba(250,250,255,0.92)] twcss-text-[color:var(--smc-ink)] twcss-font-black twcss-uppercase twcss-tracking-[0.12em] twcss-text-[0.86rem] twcss-shadow-[0_18px_42px_rgba(0,0,0,0.12)] twcss-border-[2px] twcss-border-[var(--smc-gold)] twcss-relative'
    >
      <span
        aria-hidden='true'
        class='twcss-w-[10px] twcss-h-[10px] twcss-rounded-full twcss-bg-[var(--smc-gold)] twcss-shadow-[0_0_0_4px_rgba(200,164,93,0.22)] twcss-animate-pulse'
      ></span>
      <span id='smc-pill-text'>Bereit</span>
      <span aria-hidden='true' class='twcss-hidden twcss-w-[18px] twcss-h-[10px]'></span>
    </div>
  </div>

  {% comment %} ! Main content (SMC) {% endcomment %}
  <div
    id='smc'
  >
    {% comment %} ! SLIDER CONTAINER {% endcomment %}
    <div
      id='smc-slider'
      class='twcss-flex twcss-items-start twcss-w-full twcss-h-full twcss-transition-transform twcss-duration-500 twcss-ease-in-out'
      style='transform: translateX(-100%);'
    >
      {% comment %} ! Page 1: Configuration {% endcomment %}
      <div
        id='smc-page-1'
        class='twcss-w-full twcss-flex twcss-items-center twcss-justify-center twcss-flex-shrink-0 twcss-px-4'
      >
        <div class='smc__wrap twcss-rounded-[20px] twcss-px-6 twcss-py-12 md:twcss-p-16 twcss-bg-[#fafafff5] twcss-min-w-[300px] md:twcss-min-w-[460px]'>
          <h2 class='twcss-text-3xl twcss-font-bold twcss-mb-8 twcss-text-center twcss-text-brandblack'>
            Design konfigurieren
          </h2>

          {%- assign base_product = section.settings.product -%}

          {% comment %} Hidden form for data persistence {% endcomment %}
          {% if base_product != blank %}
            <form
              method='post'
              action='{{ routes.cart_add_url }}'
              enctype='multipart/form-data'
              class='smc__form'
              id='smc-form'
            >
              <input type='hidden' name='id' value='{{ base_product.selected_or_first_available_variant.id }}'>
          {% else %}
            <div class='smc__form' id='smc-form'>
          {% endif %}

          {% comment %} ! Prompt Textarea Field {% endcomment %}
          <div class='smc__field'>
            <label class='smc__label twcss-block twcss-font-bold' for='smc-desc'>
              Motiv Beschreibung
              <span class='smc__label-note twcss-text-sm twcss-opacity-60 twcss-font-normal'>Pflichtfeld</span>
            </label>
            <textarea
              id='smc-desc'
              class='smc__textarea twcss-w-full twcss-p-4 twcss-rounded-xl twcss-border twcss-border-gray-300 twcss-min-h-[120px] twcss-max-h-[260px]'
              rows='5'
              placeholder='Lass Deiner Vorstellung freien Lauf...'
            ></textarea>
          </div>

          {% comment %} ! Upload Field {% endcomment %}
          <div class='smc__field'>
            <label class='smc__label twcss-block twcss-font-bold' for='smc-upload'>
              Motiv hochladen
              <span class='smc__label-note twcss-text-sm twcss-opacity-60 twcss-font-normal'>PNG oder JPG</span>
            </label>

            <div class='smc__file twcss-relative'>
              <input type='file' id='smc-upload' class='smc__file-input twcss-hidden' accept='image/*'>
              <label
                for='smc-upload'
                class='smc__file-ui twcss-block twcss-w-full twcss-p-4 twcss-rounded-xl twcss-border twcss-border-dashed twcss-border-gray-400 twcss-cursor-pointer hover:twcss-bg-gray-50 twcss-transition-colors'
              >
                <div class='twcss-flex twcss-items-center twcss-gap-4 twcss-w-full'>
                  <div class='smc__file-preview twcss-w-16 twcss-h-16 twcss-bg-gray-200 twcss-rounded-lg twcss-overflow-hidden twcss-flex twcss-items-center twcss-justify-center'>
                    <img
                      id='smc-upload-preview'
                      class='smc__file-preview-img twcss-w-full twcss-h-full twcss-object-cover'
                      alt=''
                      loading='lazy'
                      style='display:none'
                      width='64px'
                      height='64px'
                    >
                    <div
                      id='smc-upload-preview-empty'
                      class='smc__file-preview-empty twcss-text-2xl twcss-text-gray-400'
                    >
                      +
                    </div>
                  </div>
                  <div class='smc__file-meta'>
                    <div class='smc__file-title twcss-font-bold'>Datei wählen</div>
                    <div
                      class='smc__file-sub twcss-text-sm twcss-text-gray-500 twcss-max-w-[75px] md:twcss-max-w-[150px]'
                      id='smc-upload-label'
                    >
                      Noch kein Upload
                    </div>
                  </div>
                  <span class='smc__file-chip twcss-ml-auto twcss-bg-brandblack twcss-text-white twcss-px-3 twcss-py-1 twcss-rounded-full twcss-text-xs twcss-font-bold twcss-uppercase'
                    >Upload</span
                  >
                </div>
              </label>
            </div>
          </div>

          {% comment %} ! Material select {% endcomment %}
          <div class='smc__field twcss-mb-6'>
            <label class='smc__label twcss-block twcss-font-bold' for='smc-finish'>Oberfläche</label>
            <div class='smc__select twcss-relative'>
              <select
                id='smc-finish'
                class='smc__select-el twcss-w-full twcss-p-3 twcss-rounded-lg twcss-border twcss-border-gray-300 twcss-appearance-none twcss-cursor-pointer'
              >
                <option value='Schwarz pulverbeschichtet'>Schwarz pulverbeschichtet</option>
                <option value='Anthrazit pulverbeschichtet'>Anthrazit pulverbeschichtet</option>
                <option value='Weiß pulverbeschichtet'>Weiß pulverbeschichtet</option>
                <option value='Gold'>Gold</option>
                <option value='Cortenstahl Optik'>Cortenstahl Optik</option>
                <option value='Satinierter Edelstahl'>Satinierter Edelstahl</option>
              </select>
              <span
                class='smc__select-arrow twcss-absolute twcss-right-3 twcss-top-1/2 twcss-translate-y-[-50%] twcss-pointer-events-none'
                aria-hidden='true'
                >⌄</span
              >
            </div>
          </div>

          {% comment %} ! CTAs/buttons {% endcomment %}
          <div class='smc__actions twcss-flex twcss-gap-4 twcss-mt-2 md:twcss-mt-6 md:twcss-flex-row-reverse twcss-flex-col'>
            <div class='werkstatt-shadow-wrap twcss-flex-1'>
              <button
                type='button'
                class='werkstatt-btn twcss-w-full twcss-py-3 twcss-px-5 twcss-border-transparent twcss-bg-brandblack hover:twcss-bg-brandblack/50 twcss-transition-all twcss-duration-300 twcss-text-brandwhite twcss-shadow-xl hover:twcss-shadow-brandblack/25 twcss-rounded-full twcss-text-lg twcss-relative twcss-z-10'
                id='smc-cta-btn'
                disabled
              >
                <span class='smc__btn-label' id='smc-cta-label'>Entwurf erstellen</span>
              </button>
            </div>

            {% comment %} ! CLOSE BUTTON {% endcomment %}
            <button
              data-close-button
              class='twcss-flex-2 twcss-bg-gray-200 twcss-text-gray-700 twcss-border-2 twcss-border-gray-500 twcss-py-3 twcss-px-5 twcss-shadow-xl twcss-rounded-full twcss-text-lg twcss-relative twcss-z-10 twcss-transition-all twcss-duration-300 hover:twcss-bg-gray-300 hover:twcss-border-gray-600 hover:twcss-text-gray-600'
            >
              Ausgang Werkstatt
            </button>
          </div>

          {% comment %} Hidden inputs for cart {% endcomment %}
          <input type='hidden' name='properties[Bild]' id='smc-prop-img'>
          <input type='hidden' name='properties[Beschreibung]' id='smc-prop-desc'>
          <input type='hidden' name='properties[Oberfläche]' id='smc-prop-finish'>
          <input type='hidden' name='properties[Größe]' id='smc-prop-size'>
          <input type='hidden' name='properties[Route]' id='smc-prop-route'>
          <input type='hidden' name='properties[Generator ID]' id='smc-prop-gen'>
          <input type='hidden' name='properties[Preis]' id='smc-prop-price'>
          <input type='hidden' name='properties[Anmerkung]' id='smc-prop-note'>

          {% if base_product != blank %}
            {% comment %} Submit button is on page 3 {% endcomment %}
            </form>
          {% else %}
            </div>
          {% endif %}
        </div>
      </div>

      {% comment %} ! Page 2: Creating (Preview Area) {% endcomment %}
      <div
        id='smc-page-2'
        class='twcss-w-full twcss-flex twcss-items-center twcss-justify-center twcss-flex-shrink-0 twcss-px-4'
      >
        <div class='smc__wrap twcss-rounded-[20px] twcss-px-6 twcss-py-12 md:twcss-p-16 twcss-bg-[#fafafff5] twcss-min-w-[300px] md:twcss-min-w-[460px]'>
          <div class='twcss-flex twcss-flex-col twcss-items-center twcss-gap-6'>
            {% comment %} ! Preview Image Container {% endcomment %}
            <div class='twcss-w-full twcss-aspect-square twcss-max-w-md twcss-bg-white twcss-rounded-xl twcss-shadow-lg twcss-overflow-hidden twcss-flex twcss-items-center twcss-justify-center twcss-relative'>
              {% comment %} Loading State {% endcomment %}
              <div
                id='smc-preview-loading'
                class='twcss-absolute twcss-rounded-xl twcss-inset-0 twcss-flex twcss-flex-col twcss-items-center twcss-justify-center twcss-bg-gray-300 twcss-border-2 twcss-border-brandblack'
              >
                <div
                  class='twcss-animate-spin twcss-rounded-full twcss-h-12 twcss-w-12 twcss-border-b-2 twcss-border-brandblack'
                  style='display: block;'
                ></div>
                {% comment %} Empty State {% endcomment %}
                <div id='smc-preview-empty' class='twcss-text-center twcss-text-gray-400 twcss-p-8'>
                  <p class='twcss-text-lg twcss-font-medium'>Starte zuerst den Entwurf</p>
                </div>
              </div>

              {% comment %} Preview Image {% endcomment %}
              <img
                id='smc-preview-img'
                class='twcss-w-full twcss-h-full twcss-object-contain twcss-hidden'
                alt='Vorschau'
                loading='lazy'
                width='100%'
                height='100%'
              >
            </div>

            {% comment %} ! Action Buttons {% endcomment %}
            <div class='twcss-flex twcss-flex-col twcss-gap-4 twcss-w-full twcss-max-w-md'>
              {% comment %} Social Buttons {% endcomment %}
              <div class='twcss-flex twcss-gap-4 twcss-justify-center '>
                <button
                  type='button'
                  id='smc-preview-share'
                  class='link'
                  disabled
                  aria-label='Vorschau teilen'
                >
                  Teilen
                </button>
                <button
                  type='button'
                  id='smc-preview-download'
                  class='link'
                  disabled
                  aria-label='Vorschau herunterladen'
                >
                  Download
                </button>
              </div>

              {% comment %} Back to Configuration and Continue buttons {% endcomment %}
              <div class='twcss-flex twcss-gap-4 twcss-flex-col-reverse md:twcss-flex-row'>
                {% comment %} Back button - navigates to page 1, doesn't close modal {% endcomment %}
                <button
                  data-back-to-config
                  class='twcss-flex-2 twcss-bg-gray-200 twcss-text-gray-700 twcss-border-2 twcss-border-gray-500 twcss-py-3 twcss-px-5 twcss-shadow-xl twcss-rounded-full twcss-text-lg twcss-relative twcss-z-10 twcss-transition-all twcss-duration-300 hover:twcss-bg-gray-300 hover:twcss-border-gray-600 hover:twcss-text-gray-600'
                >
                  ← Konfiguration
                </button>

                {% comment %} Continnue button {% endcomment %}
                <div class='werkstatt-shadow-wrap twcss-flex-1'>
                  <button
                    type='button'
                    class='werkstatt-btn twcss-py-3 twcss-w-full twcss-px-5 twcss-border-transparent twcss-bg-brandblack hover:twcss-bg-brandblack/50 twcss-transition-all twcss-duration-300 twcss-text-brandwhite twcss-shadow-xl hover:twcss-shadow-brandblack/25 twcss-rounded-full twcss-text-lg twcss-relative twcss-z-10'
                    id='smc-continue-btn'
                    disabled
                  >
                    <span class='smc__btn-label' id='smc-continue-label'>Weiter →</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      {% comment %} ! Page 3: Result & Checkout {% endcomment %}
      <div
        id='smc-page-3'
        class='twcss-w-full twcss-flex twcss-items-center twcss-justify-center twcss-flex-shrink-0 twcss-px-4'
      >
        <div class='smc__wrap twcss-rounded-[20px] twcss-px-6 twcss-py-12 md:twcss-p-16 twcss-bg-[#fafafff5] twcss-min-w-[300px] md:twcss-min-w-[460px]'>
          {% comment %} ! Result container {% endcomment %}
          <div class='twcss-flex twcss-justify-center twcss-flex-col twcss-gap-8'>
            {% comment %} ! Small Preview + nanme, price and size columns {% endcomment %}
            <div class='twcss-flex twcss-items-center twcss-gap-4 twcss-flex-col md:twcss-flex-row'>
              {% comment %} * Small Preview {% endcomment %}
              <img
                id='smc-result-img'
                class='twcss-object-contain twcss-rounded-xl twcss-shadow-lg twcss-bg-white'
                alt='Dein Schild'
                loading='lazy'
                width='140px'
                height='140px'
              >
              {% comment %} * Name and size column {% endcomment %}
              <div>
                {% comment %} * Name {% endcomment %}
                <h3 id='smc-product-name' class='twcss-text-xl twcss-font-bold twcss-mb-2'>
                  Dein personalisiertes Schild
                </h3>

                {% comment %} * Size select {% endcomment %}
                <div class='smc__field'>
                  <label class='smc__label twcss-block twcss-font-bold' for='smc-size'>Größe</label>
                  <div class='smc__select twcss-relative'>
                    <select
                      id='smc-size'
                      class='smc__select-el twcss-w-full twcss-p-3 twcss-rounded-lg twcss-border twcss-border-gray-300 twcss-appearance-none twcss-cursor-pointer'
                    >
                      <option value='22,5 cm'>22,5 cm</option>
                      <option value='45 cm'>45 cm</option>
                      <option value='55 cm'>55 cm</option>
                      <option value='75 cm'>75 cm</option>
                      <option value='75 cm+'>75 cm+</option>
                    </select>
                    <span
                      class='smc__select-arrow twcss-absolute twcss-right-3 twcss-top-1/2 twcss-translate-y-[-50%] twcss-pointer-events-none'
                      aria-hidden='true'
                      >⌄</span
                    >
                  </div>
                </div>
              </div>
            </div>

            {% comment %} ! Note Field {% endcomment %}
            <div class='smc__field'>
              <label class='smc__label twcss-block twcss-font-bold' for='smc-note'>
                Anmerkung zum Design
                <span class='smc__label-note twcss-text-sm twcss-opacity-60 twcss-font-normal'>Optional</span>
              </label>
              <textarea
                id='smc-note'
                class='smc__textarea twcss-w-full twcss-p-4 twcss-rounded-xl twcss-border twcss-border-gray-300'
                rows='3'
                placeholder='Hast du noch Wünsche oder Anmerkungen?'
              ></textarea>
            </div>

            {% comment %} ! Price {% endcomment %}
            <div class='smc__price'>
              <span class='smc__label twcss-block twcss-font-bold'>Preis</span>
              <div class='smc__price-val twcss-text-2xl twcss-font-black twcss-text-brandblack' id='smc-price'></div>
            </div>

            {% comment %} ! Actions buttons {% endcomment %}
            <div class='smc__actions twcss-flex twcss-flex-col twcss-gap-4'>
              {% if base_product != blank %}
                <button
                  type='button'
                  class='smc__btn smc__btn--primary smc__btn--full twcss-w-full twcss-py-4 twcss-bg-brandblack twcss-text-white twcss-rounded-xl twcss-font-bold twcss-text-lg'
                  id='smc-atc-trigger'
                >
                  In den Warenkorb
                </button>
              {% endif %}

              <button
                type='button'
                class='twcss-flex-2 twcss-bg-gray-200 twcss-text-gray-700 twcss-border-2 twcss-border-gray-500 twcss-py-3 twcss-px-5 twcss-shadow-xl twcss-rounded-full twcss-text-lg twcss-relative twcss-z-10 twcss-transition-all twcss-duration-300 hover:twcss-bg-gray-300 hover:twcss-border-gray-600 hover:twcss-text-gray-600'
                id='smc-back-btn'
              >
                Neu anfangen
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

{% comment %} ! TIMER {% endcomment %}
<div class='smc__eta werkstatt-btn' id='smc-eta' style='display:none'>
  <span class='smc__eta-label' id='smc-eta-label'>Geschätzte Zeit</span>
  <span class='smc__eta-time' id='smc-eta-time'>02:00</span>
</div>
